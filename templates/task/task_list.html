{% extends "base.html" %}
{% block header %} My tasks {% endblock %}
{% block content %}

  <div class="container-fluid py-4">
    <div class="search-toolbar">
      <form class="row g-3 align-items-center"
            hx-get="{% url 'task:task-search' %}"
            hx-trigger="change, input changed delay:500ms"
            hx-target="#tasks">

        <div class="col-md-auto">
          <button type="button" class="btn btn-gradient-primary shadow-sm px-4 rounded-pill"
                  hx-get="{% url 'task:task-create' %}"
                  hx-target="#global_wrapper"
                  hx-swap="innerHTML">
            <i class="bi bi-plus-lg me-2"></i>New Task
          </button>
        </div>

        <div class="col-md">
          <div class="input-group">
          <span class="input-group-text bg-transparent border-0 ps-3 text-muted"
                style="z-index: 5; margin-right: -40px;">
            <i class="bi bi-search"></i>
          </span>
            <input type="search" name="search" class="form-control search-input-custom ps-5"
                   placeholder="Search tasks by name..." value="{{ request.GET.search }}">
          </div>
        </div>

        <div class="col-md-auto" style="min-width: 160px;">
          <div class="input-group">
            <span class="input-group-text bg-light border-0 rounded-start" style="border-radius: 10px 0 0 10px;">
                <i class="bi bi-flag text-muted"></i>
            </span>
            <select name="priority" class="form-select border-0 bg-light rounded-end"
                    style="border-radius: 0 10px 10px 0; cursor: pointer;">
              <option value="">All Priorities</option>
              <option value="LOW">Low</option>
              <option value="MED">Medium</option>
              <option value="HIGH">High</option>
            </select>
          </div>
        </div>

        <div class="col-md-auto">
          <div id="filter-completed-wrapper"
               class="d-flex align-items-center px-3 py-2 rounded-pill border transition-all user-select-none {% if request.GET.is_completed == 'on' %}bg-success text-white border-success active-filter{% else %}bg-light text-secondary border-light{% endif %}"
               style="cursor: pointer;"
               onclick="document.getElementById('flexSwitchCheckDefault').click();">

            <input name="is_completed"
                   class="form-check-input d-none"
                   type="checkbox"
                   id="flexSwitchCheckDefault"
                   {% if request.GET.is_completed == 'on' %}checked{% endif %}
                   hx-on:change="
                   let wrapper = document.getElementById('filter-completed-wrapper');
                   if(this.checked) {
                     wrapper.classList.remove('bg-light', 'text-secondary', 'border-light');
                     wrapper.classList.add('bg-success', 'text-white', 'border-success', 'active-filter');
                   } else {
                     wrapper.classList.add('bg-light', 'text-secondary', 'border-light');
                     wrapper.classList.remove('bg-success', 'text-white', 'border-success', 'active-filter');
                   }
                 "
                   onclick="event.stopPropagation();">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span class="small fw-bold">Completed</span>
          </div>
        </div>

        <div class="col-12 text-center htmx-indicator">
          <div class="spinner-border text-primary spinner-border-sm" role="status"></div>
        </div>
      </form>
    </div>

    <div class="row g-4" id="tasks">
      {% include "task/partials/task_list_chunk.html" %}
    </div>
  </div>

{% endblock %}
